	<!DOCTYPE html>
	<html>
	<head>
	<meta charset="utf-8">
	<title>Sheet Mapper</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.js"></script>
	<link href="https://api.mapbox.com/mapbox-gl-js/v1.7.0/mapbox-gl.css" rel="stylesheet" />
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>
	<script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.0/mapbox-gl-geocoder.min.js'></script>
	<link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.4.0/mapbox-gl-geocoder.css' type='text/css' />
	<link rel="stylesheet" href="style.css">
	<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js'></script>

	</head>
	<style>
	body {
	  margin: 0;
	  padding: 0;
	}

#map { position:absolute; top:30px; bottom:0; width:100%; }


	.mapboxgl-popup {
	  padding-bottom: 5px;
	}

	.mapboxgl-popup-close-button {
	  display: block;
	}

	.mapboxgl-popup-content {
	  font: 200 12px/15px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;
	  padding: 0;
	  width: 200px;
	  line-height:0.8;
	}

	.mapboxgl-popup-content-wrapper {
	  padding: 1%;
	}

	.mapboxgl-popup-content h3 {
	  background: #c0c0c0;
	  text-align: center;
	  color: #fff;
	  margin: 0;
	  display: block;
	  padding: 10px;
	  font-weight: 300;
	  margin-top: 5px;
		  line-height:1.2;
	}

	.mapboxgl-popup-content h4 {
	  margin: 0;
	  display: block;
	  padding: 10px 3px 10px 10px;
	  font-weight: 200;
		  line-height:0.9;
	}

	.mapboxgl-container {
	  cursor: pointer;
	}

	.mapboxgl-popup-anchor-top>.mapboxgl-popup-content {
	  margin-top: 3px;
	}

	.mapboxgl-popup-anchor-top>.mapboxgl-popup-tip {
	  border-bottom-color: rgb(61, 59, 59);
	}
	/*TRECHO ADICIONADO */
	.marker {
	background-image: url('ic_mapa.svg');
	background-color: #aaa;
	background-size: cover;
	width: 30px;
	height: 30px;
	border-radius: 50%;
	cursor: pointer;
	}	

	.geocoder {
	position:fixed;
	z-index:10;
	width:50%;
	left:20%;
	margin-left:-15%;
	top:60px;
	}	

	.rodape {
	position:fixed;
	margin-left:5%;
	bottom:4px;
    color: #800000;
	}		
	</style>

	<body>

<div id='map'></div>
	<div id='geocoder' class='geocoder'></div>
	
<!-- Top container -->
<div class="w3-bar w3-top w3-black w3-medium" style="z-index:4">
  <button class="w3-bar-item w3-button w3-hide-large w3-hover-none w3-hover-text-light-grey" onclick="w3_open();"><i class="fa fa-bars"></i>  Menu</button>  &nbsp&nbsp&nbsp&nbsp&nbsp Sheet Mapper
  <span class="w3-bar-item w3-right">SCSCYBER</span>
</div>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left " style="z-index:3;width:220px; height:250px; " id="mySidebar">

  <hr>

  <div class="w3-bar-block">
    <a href="#" class="w3-bar-item w3-button w3-padding-16 w3-hide-large w3-dark-grey w3-hover-black" onclick="w3_close()" title="close menu"><i class="fa fa-remove fa-fw"></i>  Fechar Menu</a>
    <a href="..\Serv_07.html" target="_self" class="w3-bar-item w3-button w3-padding w3-blue"><i class="fa fa-map fa-fw"></i>MAPAS</a>

					<div id='geocoder' class='geocoder'></div>
					
<p style="text-align:justify; margin:10px; font-size:12px;"> Localização de pontos de interesse - salvos em planilha Google Sheet.  </p> <br>
      
  </div>
</nav>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>	

	<script>
	  var transformRequest = (url, resourceType) => {
		var isMapboxRequest =
		  url.slice(8, 22) === "api.mapbox.com" ||
		  url.slice(10, 26) === "tiles.mapbox.com";
		return {
		  url: isMapboxRequest
			? url.replace("?", "?pluginName=sheetMapper&")
			: url
		};
	  };

//ADICIONAR Mapbox access token 
	  mapboxgl.accessToken = 'pk.eyJ1Ijoic2NzOTk5OTk5IiwiYSI6ImNqd2NtZzcyazAydmwzem4yamhma3lndmQifQ.90vf0GojkCydVu979c-CoA';

//LATITUDE/LOGITUDE VISUALIZAÇÃO
	var latY = '-22.8565832'; 	var longX = '-43.259645';	  

//LIMITES DA VISUALIZAÇÃO
//	var bounds = [
//	[-43.34196124490532, -22.894960192923506], // COORDENADAS SUDOESTE
//	[-43.20895130692733,-22.839096583402593]  // COORDENADAS NOROESTE
//	];	  

//DEFINIR PARAMETROS MAPA
	  var map = new mapboxgl.Map({
		container: 'map', // container id
		style: 'mapbox://styles/scs999999/cjxryon3s6xpo1dpl62xinjwy',
//SELECIONAR ESTILO MAPBOX https://docs.mapbox.com/api/maps/#styles
		center: [longX,latY], // POSIÇÃO INICIAL [LONG, LAT]
		zoom: 12, // ZOOM INICIAL
		minZoom: 11, // 
		maxZoom: 18,
		transformRequest: transformRequest
//		maxBounds: bounds, // Sets bounds as max
	  });

//ADICIONAR CONTROLE DE NAVEGAÇÃO
			var nav = new mapboxgl.NavigationControl();
			map.addControl(nav, 'top-right');


//ADICIONAR CONTROLE TELA CHEIA
			map.addControl(new mapboxgl.FullscreenControl());
			
//ADICIONAR ESCALA
			map.addControl(new mapboxgl.ScaleControl({
				maxWidth: 0,
				unit: 'metric' //imperial for miles
			}));

//ADICIONAR CONTROLE DE GEOLOCALIZAÇÃO
			map.addControl(new mapboxgl.GeolocateControl({
				positionOptions: {
					enableHighAccuracy: true
				},
				trackUserLocation: true
			}));	  
	  
	  map.on("load", function() {
		init();
	  });

// INICIALIZAR Tabletop PARA ACESSAR A TABELA(PLANILHA)
	  function init() {
		Tabletop.init({
// LINK COMPARTILHAVEL DA PLANILHA
		  key: 'https://docs.google.com/spreadsheets/d/1KgGM5rJMue03YIPBdoAeyX19F7PWBvVbj_eDUosrods/edit?usp=sharing',
// CHAMAR A FUNÇÃO ADDPOINTS
		  callback: addPoints,
		  simpleSheet: true
		});
	  }
	  
//https://docs.google.com/spreadsheets/d/1_srcsJvvoVN9x4kCAetvvX4qbvqAU23lxXL1KSqs-7I/edit?usp=sharing	  
	  
// CRIAR FUNÇÃO addPoints BUSCANDO OS DADOS DA TABELA LINHA POR LINHA PARA CRIAR MARCAS E POPUPS
	  function addPoints(data) {

		data.forEach(function(row) {

//TRECHO ADICIONADO		
	// CODIGO PARA MARCA PERSONALIZADA
	var el = document.createElement('div');
	el.className = 'marker';
//TRECHO ADICIONADO		

// INFORMAÇÕES EXIBIDAS NO POPUP
		  var popup = new mapboxgl.Popup()
			.setHTML('<h3>' + row.Nome + '</h3>' + '<h4>' + '<b>' + '' + '</b>' + row.Endereço + '</h4>' + '<h4>' + '<b>' + ' ' + '</b><a>' + row.Telefone + '</a></h4>'+ '<h3><a href = "https://www.google.com.br/maps/@'+row.Latitude + ','+ row.Longitude +',20z" target="_blank"> Ver no Google Maps </h3></a>'); // use the table to populate your popup with text
			
	//TRECHO ALTERADO		
	//SUBSTITUIDO PARAMETRO MARKER(el)
	//PASSANDO 
		  // create a variable for your markup and add it to the map 
		  var marker = new mapboxgl.Marker(el)
			.setLngLat([row.Longitude, row.Latitude])
			.setPopup(popup)
			.addTo(map); // add the marker to the map
		});
	  }

//CRIA UMA MARCA AO SELECIONAR ENDEREÇO NA CAIXA DE PESQUISA
//	var marker = new mapboxgl.Marker({
	//draggable: true
//	})
//	.setLngLat([longX,latY])
//	.addTo(map);


	map.touchZoomRotate.enable();
	map.touchZoomRotate.enableRotation();

	var geocoder = new MapboxGeocoder({
	accessToken: mapboxgl.accessToken,
	flyTo: {
	bearing: 280,
	pitch: 200,
	speed: 0.5, 
	curve: 1, 
	zoom:18,
	easing: function (t) { return t; }
	},
	mapboxgl: mapboxgl
	});
//INSERE A MARCA NO DEVIDO LOCAL PESQUISADO

	document.getElementById('geocoder').appendChild(geocoder.onAdd(map));
	
	</script>
	<script>
// Get the Sidebar
var mySidebar = document.getElementById("mySidebar");

// Get the DIV with overlay effect
var overlayBg = document.getElementById("myOverlay");

// Toggle between showing and hiding the sidebar, and add overlay effect
function w3_open() {
  if (mySidebar.style.display === 'block') {
    mySidebar.style.display = 'none';
    overlayBg.style.display = "none";
  } else {
    mySidebar.style.display = 'block';
    overlayBg.style.display = "block";
  }
}

// Close the sidebar with the close button
function w3_close() {
  mySidebar.style.display = "none";
  overlayBg.style.display = "none";
}
</script>	
	
	<div class="rodape">
<h5> Desenvolvido por SCSCYBER Informática </h5>
</div>
	</body>

	</html>